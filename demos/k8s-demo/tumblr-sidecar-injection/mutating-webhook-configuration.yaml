apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: "tumblr-sidecar-injector-webhook"
  labels:
    app: k8s-sidecar-injector
    track: prod
webhooks:
- name: "injector.tumblr.com"
  failurePolicy: "Ignore" # we fail "open" if the webhook is down hard
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  clientConfig:
    # https://github.com/kubernetes/kubernetes/blob/v1.10.0-beta.1/staging/src/k8s.io/api/admissionregistration/v1beta1/types.go#L218
    # note: k8s is smart enough to use 443 or the only exposed port on the service
    # note: this requires the service to serve TLS directly (not thru ingress)
    service:
      name: "k8s-sidecar-injector-prod"
      namespace: "kube-system"
      path: "/mutate"   # what /url/slug to send requests at
    # Demo/Tutorial only cabundle, generate your own for production,
    # see https://github.com/tumblr/k8s-sidecar-injector/blob/master/docs/tls.md
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZsRENDQTN3Q0NRQ0Vpb1g3a1hlSWVUQU5CZ2txaGtpRzl3MEJBUXNGQURDQmlqRUxNQWtHQTFVRUJoTUMKVlVzeER6QU5CZ05WQkFnTUJreHZibVJ2YmpFVE1CRUdBMVVFQnd3S1EyaHBZMmhsYzNSbGNqRVJNQThHQTFVRQpDZ3dJZDJobGNtVnViM2N4SURBZUJnTlZCQU1NRjJzNGN5MXphV1JsWTJGeUxXbHVhbVZqZEc5eUxVTkJNU0F3CkhnWUpLb1pJaHZjTkFRa0JGaEZvZFdkb1FIZG9aWEpsYm05M0xtOXlaekFnRncweE9UQXpNRGt4TXpBeU5ETmEKR0E4ME56VTNNREl3TWpFek1ESTBNMW93Z1lveEN6QUpCZ05WQkFZVEFsVkxNUTh3RFFZRFZRUUlEQVpNYjI1awpiMjR4RXpBUkJnTlZCQWNNQ2tOb2FXTm9aWE4wWlhJeEVUQVBCZ05WQkFvTUNIZG9aWEpsYm05M01TQXdIZ1lEClZRUUREQmRyT0hNdGMybGtaV05oY2kxcGJtcGxZM1J2Y2kxRFFURWdNQjRHQ1NxR1NJYjNEUUVKQVJZUmFIVm4KYUVCM2FHVnlaVzV2ZHk1dmNtY3dnZ0lpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFEUQpFSk1zRTJGNkdjbDYrLzFNajdFMiswRVp0NXAxSXdmS2tQQUdPanEzaXg0U0ZkcEdTT01FVDB4QXdRK3ZKbUw2Cms4a1lDeGRSMXJuaGhXWFdsckRzdDRBc24xaGJzTXlCS2N0cjkyaDFuYmRYdXhlMDdZL3RlQ2s5dC81eU5jeHQKZG5VVkZlbVF0SU40RHFqVU4rc3J3VkRvV1M4aDYxTEdPMkFBZ0FWaGFXTFBGeXkxam8wcU1rbFFGamFMNCtOUApXMlNlTVVDMG05SXN4ZjBvbXpSQTR5WWsxQS9mSjNlSCsxdHhXZjVQWHNJNEZ4TlJKaTc2MVZnQXlPUi9qdENyCnNndXdhQzh6NkZLOURBZGxmYWpYTnZVeFJMb2hUN1c2eWl6TGxhb1RWOXFBZXkrNkpIN1ZWU1U4WkVicjNiTmcKVlVmOUYycVV6VDV2T0syV0YzZ21ub3FLVklFUXlTT1QzcjVmUHNyamdmejRsU3lwb2luNWlvMU1FeE4xSlJSMgpOc3oxVllpeUFka21aQlZGaU9ZdFVrZy9oRXJiVEhwZk4xWkpJQWpOK2VINGxTdldXMExEeENXcTQ2UDgrWUVECmtEeDZkYk9ralNraDJvQnk3SkdIY3hoZ3d5VjdKMnRiM3Vjd2JZbVphc3JNT1VTUGFSZEQxeEUyWldDWXU3U2oKbmFRamV3K0xRd2FIY1N0ODIxb1U3TXVHWVVEcUdGNU94Q1dvSTJGUWhQdlBXTTBlblFKbXYreUpJb1lDZ2o4bgp0QnBYaDVvRjdYdlBUbi9rUCtMVmFBZkNMMlpwM2lpYXRCRUFNZFRqbWlPN0plaHVISytDbmhmMXhHUVFqVWtLCjJ5c2tqcXU4OEoycmZmR1pya3ducWkwZ0VZenhsTFRzM253TXlzWlJ2UUlEQVFBQk1BMEdDU3FHU0liM0RRRUIKQ3dVQUE0SUNBUUNyckpMWnd5aWpROTZrckJhandwaUVJRzhZTkNIVDlsV2FHWEVBd1ZRTFgvV0FLLzlZT01TaApvSmNERjNaQVFha2lmcGcyYXQ3MDc1SElEdm9FVnhGdlJvUzMwb3ZGNFRkUEFhYy93MXVRS1BNNHUrZFpZRjAwCnFhRCt1dUUwMktCRVdvdFh3cTlZUmlORFRKajFrZWcxU0xDY2ZjdW9KN084UEIzeU5QejUzdWUrRk5wYlljbGIKZVRvTDM5Wm1JWE9FMkE4bXB2MUFQRDFnNkdOWEFwdmN4aE8zRGxGWWR3TUlOcGlWSkw1WC9Vc2NBVnk0TzBwRgpvUnNhVzRabFNsb2crMjRmaXY3YmRxQXl2eGl3YS9jZ1g5ajZ1MjgzSm9HMG5ZTHZEM3dKOHRPb2VmWDh3aU15CnVIWWw2ZnRHaFhFWEdkaUl5QmZkMS92MjFmeFdabzArcktrT1lwT1gxL29TNW9VUGpoZ29MaEtuV0ErVFZBTXYKMStlZFVOeVNUL3h3RDFOTDhkRWRGT1dCOWo4ZHB2L0lPWHAzSUc3QmtTbWdlTDhQdTF5cTA3K3NUK29yaXZCZQpMS3lBZzFULzh4NGE1NWIxRlJqVmFtSUpVTDlOcGQ5T1FjV2ZCMmJ0N1EreXllUmZreTVsMVhmNW84b0JqaGswCjVaNVEzNlppMmQxM2RKaCtVZS9GcG5VZC9PbFpvQXR5Vm5EWkZFNXVoSDduRk9vbHVQbGNnZmdnRjhaK0dRQ0YKeTBjdUNnZ1pEekN3ZTNPWU42amhNVllDcC9Pd1BsQW0vOHZpZ2tKcTlabENYd3RVS2U1OTc3d3dYWmVYTWNsYQo4LzhKc0R4OElyUW5SMmlZejBMdnRaTlFwTVI0YWdZekV1U2ZmaTEzZVpiQms1ellIODlFWWc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
